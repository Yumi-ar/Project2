<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©er une Ordonnance - Global Hospitals</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .form-container {
            padding: 40px;
        }

        .patient-info {
            background: #f8f9ff;
            border: 2px solid #e3f2fd;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .patient-info h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .patient-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .patient-detail {
            display: flex;
            align-items: center;
        }

        .patient-detail strong {
            color: #34495e;
            margin-right: 10px;
            min-width: 120px;
        }

        .form-section {
            margin-bottom: 35px;
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.2);
            background: white;
        }

        .medications-section {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .medication-item {
            background: white;
            border: 2px solid #e3f2fd;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .medication-item:last-of-type {
            margin-bottom: 0;
        }

        .medication-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .medication-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .remove-medication {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .remove-medication:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .medication-fields {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 15px;
        }

        .add-medication-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }

        .add-medication-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
        }

        .form-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #ecf0f1;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .required {
            color: #e74c3c;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .form-container {
                padding: 20px;
            }

            .patient-details {
                grid-template-columns: 1fr;
            }

            .medication-fields {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Cr√©er une Ordonnance</h1>
            <p>Prescription m√©dicale pour {{ patient.nom }} {{ patient.prenom }}</p>
        </div>

        <div class="form-container">
            <!-- Informations du patient -->
            <div class="patient-info">
                <h3>üë§ Informations du Patient</h3>
                <div class="patient-details">
                    <div class="patient-detail">
                        <strong>Nom complet:</strong>
                        {{ patient.nom }} {{ patient.prenom }}
                    </div>
                    <div class="patient-detail">
                        <strong>Date de naissance:</strong>
                        {{ patient.date_naissance|date:"d/m/Y" }}
                    </div>
                    <div class="patient-detail">
                        <strong>N¬∞ S√©curit√© Sociale:</strong>
                        {{ patient.numero_securite_sociale }}
                    </div>
                    <div class="patient-detail">
                        <strong>T√©l√©phone:</strong>
                        {{ patient.telephone }}
                    </div>
                </div>
            </div>

            <!-- Formulaire d'ordonnance -->
            <form method="post" id="ordonnanceForm">
                {% csrf_token %}
                
                <div class="form-section">
                    <h3>üìã Informations de l'Ordonnance</h3>
                    
                    <div class="form-group">
                        <label for="titre">Titre de l'ordonnance <span class="required">*</span></label>
                        <input type="text" id="titre" name="titre" required 
                               placeholder="Ex: Traitement diab√®te et hypertension"
                               value="{{ form.titre.value|default:'' }}">
                    </div>

                    <div class="form-group">
                        <label for="date_prescription">Date de prescription <span class="required">*</span></label>
                        <input type="date" id="date_prescription" name="date_prescription" required
                               value="{{ form.date_prescription.value|default:'now'|date:'Y-m-d' }}">
                    </div>

                    <div class="form-group">
                        <label for="duree_validite">Dur√©e de validit√© (en mois) <span class="required">*</span></label>
                        <select id="duree_validite" name="duree_validite" required>
                            <option value="1">1 mois</option>
                            <option value="2">2 mois</option>
                            <option value="3" selected>3 mois</option>
                            <option value="6">6 mois</option>
                            <option value="12">12 mois</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="notes_medecin">Notes du m√©decin</label>
                        <textarea id="notes_medecin" name="notes_medecin" rows="3"
                                  placeholder="Notes compl√©mentaires, recommandations particuli√®res...">{{ form.notes_medecin.value|default:'' }}</textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üíä M√©dicaments Prescrits</h3>
                    
                    <div class="medications-section">
                        <div id="medications-container">
                            <!-- Premier m√©dicament par d√©faut -->
                            <div class="medication-item">
                                <div class="medication-header">
                                    <div class="medication-number">1</div>
                                    <button type="button" class="remove-medication" onclick="removeMedication(this)" style="display: none;">√ó</button>
                                </div>
                                <div class="medication-fields">
                                    <div class="form-group">
                                        <label>Nom du m√©dicament <span class="required">*</span></label>
                                        <input type="text" name="medicament_nom[]" required 
                                               placeholder="Ex: Metformine 1000mg">
                                    </div>
                                    <div class="form-group">
                                        <label>Posologie et instructions <span class="required">*</span></label>
                                        <input type="text" name="medicament_posologie[]" required 
                                               placeholder="Ex: 1 comprim√© matin et soir pendant les repas">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" class="add-medication-btn" onclick="addMedication()">
                            <span>‚ûï</span>
                            Ajouter un m√©dicament
                        </button>
                    </div>
                </div>

                <div class="form-actions">
                    <a href="{% url 'patient_detail' patient.id %}" class="btn btn-secondary">
                        ‚Ü©Ô∏è Retour au dossier
                    </a>
                    <button type="submit" class="btn btn-primary">
                        üíæ Cr√©er l'ordonnance
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let medicationCount = 1;

        function addMedication() {
            medicationCount++;
            const container = document.getElementById('medications-container');
            const medicationDiv = document.createElement('div');
            medicationDiv.className = 'medication-item';
            
            medicationDiv.innerHTML = `
                <div class="medication-header">
                    <div class="medication-number">${medicationCount}</div>
                    <button type="button" class="remove-medication" onclick="removeMedication(this)">√ó</button>
                </div>
                <div class="medication-fields">
                    <div class="form-group">
                        <label>Nom du m√©dicament <span class="required">*</span></label>
                        <input type="text" name="medicament_nom[]" required 
                               placeholder="Ex: Metformine 1000mg">
                    </div>
                    <div class="form-group">
                        <label>Posologie et instructions <span class="required">*</span></label>
                        <input type="text" name="medicament_posologie[]" required 
                               placeholder="Ex: 1 comprim√© matin et soir pendant les repas">
                    </div>
                </div>
            `;
            
            container.appendChild(medicationDiv);
            updateMedicationNumbers();
        }

        function removeMedication(button) {
            const medicationItem = button.closest('.medication-item');
            medicationItem.remove();
            medicationCount--;
            updateMedicationNumbers();
        }

        function updateMedicationNumbers() {
            const medications = document.querySelectorAll('.medication-item');
            medications.forEach((med, index) => {
                const numberDiv = med.querySelector('.medication-number');
                const removeBtn = med.querySelector('.remove-medication');
                
                numberDiv.textContent = index + 1;
                
                // Masquer le bouton de suppression s'il n'y a qu'un seul m√©dicament
                if (medications.length === 1) {
                    removeBtn.style.display = 'none';
                } else {
                    removeBtn.style.display = 'block';
                }
            });
        }

        // Validation du formulaire
        document.getElementById('ordonnanceForm').addEventListener('submit', function(e) {
            const medications = document.querySelectorAll('input[name="medicament_nom[]"]');
            let hasValidMedication = false;
            
            medications.forEach(input => {
                if (input.value.trim() !== '') {
                    hasValidMedication = true;
                }
            });
            
            if (!hasValidMedication) {
                e.preventDefault();
                alert('Veuillez ajouter au moins un m√©dicament √† l\'ordonnance.');
                return false;
            }
        });

        // Auto-focus sur le premier champ
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('titre').focus();
        });
    </script>
</body>
</html>